<html>

<header>
    <title>NoxuNote - Dessin</title>
    <link rel="stylesheet" type="text/css" href="../../../node_modules/@fortawesome/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="../../../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./style/custom-bootstrap.css">
    <link rel="stylesheet" href="./style/draw.css">
</header>

<body>
    <canvas id="canvas"></canvas>
    <div id="ui">
        <div class="ui ui-left">
            <div class="uiBar uiBar-vertical">
                <button class="btn"
                    v-bind:class="{'btn-primary': ui.controlBars.cursor, 'btn-secondary': !ui.controlBars.cursor}"
                    onclick="enableControlBar('cursor')">
                    <i class="fas fa-mouse-pointer"></i>
                </button>
                <button class="btn"
                    v-bind:class="{'btn-primary': ui.controlBars.freeDraw, 'btn-secondary': !ui.controlBars.freeDraw}"
                    onclick="enableControlBar('freeDraw')">
                    <i class="fas fa-pencil-alt"></i>
                </button>
                <button class="btn"
                v-bind:class="{'btn-primary': ui.controlBars.objects, 'btn-secondary': !ui.controlBars.objects}"
                onclick="enableControlBar('objects')">
                <i class="fas fa-shapes"></i>
                </button>
                <button class="btn"
                    v-bind:class="{'btn-primary': ui.controlBars.text, 'btn-secondary': !ui.controlBars.text}"
                    onclick="enableControlBar('text')">
                    <i class="fas fa-font"></i>
                </button>
                <button class="btn"
                    v-bind:class="{'btn-primary': ui.controlBars.chart, 'btn-secondary': !ui.controlBars.chart}"
                    onclick="enableControlBar('chart')">
                    <i class="fas fa-chart-line"></i>
                </button>
                <button class="btn"
                    v-bind:class="{'btn-primary': ui.controlBars.grid, 'btn-secondary': !ui.controlBars.grid}"
                    onclick="enableControlBar('grid')">
                    <i class="fas fa-border-none"></i>
                </button>
            </div>
        </div>
        <div class="ui ui-topleft">
            <div v-if="ui.controlBars.freeDraw" class="uiBar">
                <span>Épaisseur : </span>
                <input class="d-inline-block form-control custom-range" style="width: 100px;" type="range" min=1 max=15 value=4
                @change="canvas.freeDrawingBrush.width = parseInt($event.target.value, 10) || 4">
                <span>Couleur : </span><input class="d-inline-block form-control form-control-color" style="width: 100px;" type="color" value="#FFFFFF"
                @change="canvas.freeDrawingBrush.color = $event.target.value">
            </div>
            <div v-if="ui.controlBars.grid" class="uiBar">
                <button class="btn btn-secondary" onclick="canvasGrid.toggleGrid()">
                    Grille <span class="badge badge-dark">{{ grid.showGrid ? 'On' : 'Off' }}</span>
                </button>
                <button class="btn btn-secondary" onclick="canvasGrid.toggleSnapToGrid()">
                    Coller à la grille <span class="badge badge-dark">{{ grid.snapToGrid ? 'On' : 'Off' }}</span>
                </button>
                Échelle : <input type="number" class="form-control-number" v-model="grid.gridSize"
                    @change="gridSizeChangeEvt">
            </div>
            <div v-if="ui.controlBars.objects" class="uiBar">
                <button class="btn btn-secondary" onclick="lineInserter.insert()">
                    <i class="fas fa-slash"></i>
                </button>
                <button class="btn btn-secondary" onclick="shapeInserter.insert('square')">
                    <i class="far fa-square"></i>
                </button>
                <button class="btn btn-secondary" onclick="shapeInserter.insert('circle')">
                    <i class="far fa-circle"></i>
                </button>
            </div>
            <div v-if="ui.controlBars.text" class="uiBar">
                <button class="btn btn-secondary" onclick="shapeInserter.insert('text')">
                    <i class="fas fa-font"></i> Ligne de texte
                </button>
            </div>
            <div v-if="ui.controlBars.chart" class="uiBar">
                <button class="btn btn-secondary" data-toggle="modal" data-target="#plotModal">
                    <i class="fas fa-chart-line"></i> Fonction
                </button>
            </div>
        </div>
        <div class="ui ui-botLeft">
            <p v-if="ui.zoomFactor != 1" style="width: 130px; text-align: center">
                Échelle : {{ ui.zoomFactor.toFixed(2) }}
            </p>
        </div>
        <div class="ui ui-bottom">
            <div class="uiBar">
                <button class="btn btn-secondary" @click="history.undo()"><i class="fas fa-undo-alt"></i></button>
                <button class="btn btn-secondary" @click="history.redo()"><i class="fas fa-redo-alt"></i></button>
            </div>
        </div>
        <div class="ui ui-message" v-if="ui.message.length">
            <p>{{ui.message}}</p>
        </div>
        <div v-if="canvas!=null && selected.length" class="ui ui-right ui-solidBlock">
            <div>
                <h4>Sélection</h4>
                <div>
                    <h5>Gérer</h5>
                    <button class="btn btn-secondary" @click="canvas.getActiveObjects().forEach(o=>canvas.remove(o))" data-toggle="tooltip" data-placement="bottom" v-bind:title="$t('delete')">
                        <i class="fas fa-trash" style="color: #ff7676"></i>
                    </button>     
                    <button v-if="canvas.getActiveObject() && canvas.getActiveObject().type == 'activeSelection'" class="btn btn-secondary" @click="canvas.getActiveObject().toGroup();updateSelectedObjs()"><i class="fas fa-object-group"></i></button>               
                    <button v-if="canvas.getActiveObject() && canvas.getActiveObject().type == 'group'" class="btn btn-secondary" @click="canvas.getActiveObject().toActiveSelection();updateSelectedObjs()"><i class="fas fa-object-ungroup"></i></button>               
                    <div v-if="selected.length == 1" class="d-inline">
                        <button class="btn btn-secondary" @click="duplicate.cloneObject(selected[0])" data-toggle="tooltip" data-placement="bottom" v-bind:title="$t('duplicate')">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="btn btn-secondary" @click="duplicate.cloneInstance(selected[0])" data-toggle="tooltip" data-placement="bottom" v-bind:title="$t('duplicate_instance')">
                            <i class="fas fa-venus-double"></i>
                        </button>
                    </div>
                    <h5>Hauteur</h5>
                    <button class="btn btn-secondary" @click="selected.forEach(o=>canvas.sendToBack(o))"><i class="fas fa-angle-double-down"></i></button>               
                    <button class="btn btn-secondary" @click="selected.forEach(o=>canvas.sendBackwards(o))"><i class="fas fa-angle-down"></i></button>               
                    <button class="btn btn-secondary" @click="selected.forEach(o=>canvas.bringForward(o))"><i class="fas fa-angle-up"></i></button>               
                    <button class="btn btn-secondary" @click="selected.forEach(o=>canvas.bringToFront(o))"><i class="fas fa-angle-double-up"></i></button>          
                </div>
                <div v-if="selected.length == 1">
                    <h5>Proprietés de {{ $t(selected[0].type) }}</h5>
                    <form action="javascript:void(0);">
                        <div v-for="property in ShapeInserter.getProperties(selected[0])" class="form-group">
                            <label v-bind:for="'edit_'+property.name"></label>{{ $t(property.name) }} :
                            <input v-if="property.type == 3" v-bind:id="'edit_'+property.name" type="color" class="form-control" v-bind:value="property.value" @change="handlePropertyChange($event, property, [selected[0]])">
                            <input v-if="property.type == 1" v-bind:id="'edit_'+property.name" type="range" class="form-control custom-range" min=0 max=15 step=1 v-bind:value="property.value" @change="handlePropertyChange($event, property, [selected[0]])">
                            <input v-if="property.type == 0" v-bind:id="'edit_'+property.name" type="number" class="form-control" v-bind:value="property.value" @change="handlePropertyChange($event, property, [selected[0]])">
                            <input v-if="property.type == 2" v-bind:id="'edit_'+property.name" type="range" class="form-control custom-range" min=0 max=1 step=0.05 v-bind:value="property.value" @change="handlePropertyChange($event, property, [selected[0]])">
                            <select v-if="property.type == 4" v-bind:id="'edit_'+property.name" class="custom-select" v-bind:value="property.value" @change="handlePropertyChange($event, property, [selected[0]])">
                                <option v-for="font in fonts" v-bind:value="font" v-bind:style="`font-family: ${font}`">{{font}}</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div v-if="selected.length > 1">
                    <h6>Objets sélectionnées ({{selected.length}}) :</h6>
                    <div v-for="obj in selected">
                        {{ $t(obj.type) }}
                    </div>
                    <h6>Proprietés communes</h6>
                    <form action="javascript:void(0);">
                        <div v-for="property in ShapeInserter.getCommonProperties(selected)" class="form-group">
                            <label v-bind:for="'edit_'+property.name"></label>{{ $t(property.name) }} :
                            <input v-if="property.type == 3" v-bind:id="'edit_'+property.name" type="color" class="form-control" v-bind:value="property.value" @change="handlePropertyChange($event, property, selected)">
                            <input v-if="property.type == 1" v-bind:id="'edit_'+property.name" type="range" class="form-control custom-range" min=0 max=15 step=1 v-bind:value="property.value" @change="handlePropertyChange($event, property, selected)">
                            <input v-if="property.type == 0" v-bind:id="'edit_'+property.name" type="number" class="form-control" v-bind:value="property.value" @change="handlePropertyChange($event, property, selected)">
                            <input v-if="property.type == 2" v-bind:id="'edit_'+property.name" type="range" class="form-control custom-range" min=0 max=1 step=0.05 v-bind:value="property.value" @change="handlePropertyChange($event, property, selected)">
                            <select v-if="property.type == 4" v-bind:id="'edit_'+property.name" class="custom-select" v-bind:value="property.value" @change="handlePropertyChange($event, property, selected)">
                                <option v-for="font in fonts" v-bind:value="font" v-bind:style="`font-family: ${font}`">{{font}}</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
        </div>

         <!-- Modale d'insertion de formule -->
        <div class="modal fade" id="plotModal" tabindex="-1" role="dialog" aria-labelledby="plotModal" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Formule</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon1">f(x) = </span>
                        </div>
                        <input type="text" class="form-control" v-model="plot.expression">
                    </div>
                    <div class="container">
                        <div class="row">
                            <div class="col-sm">
                                xMin : <input type="number" class="form-control-number" v-model="plot.xMin">
                            </div>
                            <div class="col-sm">
                                xMax : <input type="number" class="form-control-number" v-model="plot.xMax">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm">
                                yMin : <input type="number" class="form-control-number" v-model="plot.yMin">
                            </div>
                            <div class="col-sm">
                                yMax : <input type="number" class="form-control-number" v-model="plot.yMax">
                            </div>
                        </div>
                    </div>
                    <div class="form-check">
                        <label class="form-check-label" for="plotRepere">
                            Repères
                        </label>
                        <input class="form-check-input" type="checkbox" v-model="plot.repere" id="plotRepere">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="shapeInserter.insert('text')"><i class="fas fa-chart-line"></i> Insérer</button>
                </div>
                </div>
            </div>
        </div>

    </div>
</body>
<footer>
    <script>var exports = { "__esModule": true };</script>
    <script src="../../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="./draw.js"></script>
</footer>

</html>